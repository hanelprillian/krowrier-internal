(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{"f+XR":function(t,e,r){"use strict";r.r(e);var a=r("o0o1"),s=r.n(a),i=(r("AuhY"),r("+jP+"));function o(t,e,r,a,s,i,o){try{var n=t[i](o),l=n.value}catch(t){return void r(t)}n.done?e(l):Promise.resolve(l).then(a,s)}function n(t){return function(){var e=this,r=arguments;return new Promise(function(a,s){var i=t.apply(e,r);function n(t){o(i,a,s,n,l,"next",t)}function l(t){o(i,a,s,n,l,"throw",t)}n(void 0)})}}var l={data:function(){return{result:{data:[],total:0,total_distance:0,loading:!1},filter_report:{search_feeder_keyword:"",search_feeder_box_opened:!1,search_feeder_result:[],feeder_name:"",feeder_id:"",status_name:"All",status:"",method:"current_year",selected_year:moment().format("YYYY"),_selected_year_formatted:moment().format("YYYY"),from_month:moment().format("YYYY/MM"),_from_month_format:moment().format("MMMM YYYY"),to_month:moment().format("YYYY/MM"),_to_month_format:moment().format("MMMM YYYY"),from_date:moment().format("YYYY/MM/DD"),_from_date_format:moment().format("DD MMMM YYYY"),to_date:moment().format("YYYY/MM/DD"),_to_date_format:moment().format("DD MMMM YYYY"),current_year:moment().format("YYYY")}}},watch:{"filter_report.search_feeder_keyword":_.debounce(function(){var t=n(s.a.mark(function t(e){var r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!((r=this).filter_report.search_feeder_keyword.length>2)){t.next=7;break}return t.next=4,r.searchFeeder();case 4:r.filter_report.search_feeder_box_opened=!0,t.next=8;break;case 7:r.filter_report.search_feeder_box_opened=!1;case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),500),"filter_report.status":function(){this.filter_report.status_name="All",""==this.filter_report.status&&null==this.filter_report.status||(0==this.filter_report.status?this.filter_report.status_name="On Progress":1==this.filter_report.status&&(this.filter_report.status_name="Completed"))}},components:{Datepicker:i.a},methods:{selectFeeder:function(t,e){this.filter_report.feeder_id=t,this.filter_report.feeder_name=e,this.filter_report.search_feeder_keyword="",this.filter_report.search_feeder_box_opened=!1},unselectFeeder:function(){this.filter_report.feeder_id="",this.filter_report.feeder_name="",this.result.data=[]},searchFeeder:function(){var t=n(s.a.mark(function t(){var e,r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(e=this).filter_report.search_feeder_result=[],r=db.collection("feeder"),t.next=5,r.get().then(function(){var t=n(s.a.mark(function t(r){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=1,t.next=3,r.forEach(function(){var t=n(s.a.mark(function t(r){var i;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(i=r.data()).id=r.id,-1!==i.fullname.toLowerCase().indexOf(e.filter_report.search_feeder_keyword)&&a<=10&&(e.filter_report.search_feeder_result.push(i),a++);case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}());case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}());case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),printElem:function(t){return func.printElem(t)},generateReport:function(){var t=n(s.a.mark(function t(){var e,r,a=this;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this,this.result.loading=!0,this.result.data=[],this.result.total=0,this.result.total_distance=0,swal.fire({title:"Generating Report",text:"Please waiting..",allowOutsideClick:!1,allowEscapeKey:!1,onOpen:function(){swal.showLoading()}}),r=db.collection("feeder_task").where("create_unix_time",">=",moment(this.filter_report.current_year.toString()).startOf("year").valueOf()).where("create_unix_time","<=",moment(this.filter_report.current_year.toString()).endOf("year").valueOf()),"by_year"==e.filter_report.method?r=db.collection("feeder_task").where("create_unix_time",">=",moment(this.filter_report.selected_year.toString()).startOf("year").valueOf()).where("create_unix_time","<=",moment(this.filter_report.selected_year.toString()).endOf("year").valueOf()):"month_range"==e.filter_report.method?r=db.collection("feeder_task").where("create_unix_time",">=",moment(this.filter_report.from_month.toString()).startOf("month").valueOf()).where("create_unix_time","<=",moment(this.filter_report.to_month.toString()).endOf("month").valueOf()):"date_range"==e.filter_report.method&&(r=db.collection("feeder_task").where("create_unix_time",">=",moment(this.filter_report.from_date.toString()).valueOf()).where("create_unix_time","<=",moment(this.filter_report.to_date.toString()).valueOf())),r=r.where("feeder_id","==",e.filter_report.feeder_id),t.next=11,r.orderBy("create_unix_time","desc").get().then(function(){var t=n(s.a.mark(function t(e){var r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a.result.total=e.size,r=0,e.forEach(function(){var t=n(s.a.mark(function t(e){var i;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(i=e.data()).id=e.id,i.distance&&(r+=parseFloat(i.distance)),a.result.data.push(i);case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()),a.result.total_distance=r,a.result.loading=!1;case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}());case 11:swal.close();case 12:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},mounted:function(){var t=n(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:$(".formSelect").selectpicker();case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),updated:function(){$(".formSelect").selectpicker("refresh")}},c=r("KHd+"),d=Object(c.a)(l,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"container-fluid",staticStyle:{height:"100%"}},[t._m(0),t._v(" "),r("div",{staticClass:"row"},[r("div",{staticClass:"col-xl-12"},[r("div",{attrs:{id:"filterSection"}},[r("div",{staticClass:"widget has-shadow"},[t._m(1),t._v(" "),r("div",{staticClass:"widget-body"},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-lg-3 col-md-3 col-sm-3 col-xs-3"},[r("div",{staticClass:"form-group"},[t._m(2),t._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:t.filter_report.method,expression:"filter_report.method"}],staticClass:"form-control formSelect btn-sm no-margin",attrs:{name:"",id:""},on:{change:function(e){var r=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.filter_report,"method",e.target.multiple?r:r[0])}}},[r("option",{attrs:{value:"current_year"}},[t._v("Current Year ("+t._s(t.filter_report.current_year)+")")]),t._v(" "),r("option",{attrs:{value:"by_year"}},[t._v("By Year")]),t._v(" "),r("option",{attrs:{value:"month_range"}},[t._v("By Month")]),t._v(" "),r("option",{attrs:{value:"date_range"}},[t._v("By Date")])])])]),t._v(" "),r("div",{staticClass:"col-lg-3 col-md-3 col-sm-3 col-xs-3"},[r("div",{staticClass:"form-group"},[t._m(3),t._v(" "),""!=t.filter_report.feeder_id?r("p",{staticClass:"form-control-static mr-sm-2"},[t._v("\n                                            "+t._s(t.filter_report.feeder_name)+"\n                                            "),r("a",{staticClass:"float-right text-danger",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.unselectFeeder()}}},[r("i",{staticClass:"ion-close"})])]):t._e(),t._v(" "),""==t.filter_report.feeder_id?r("input",{directives:[{name:"model",rawName:"v-model",value:t.filter_report.search_feeder_keyword,expression:"filter_report.search_feeder_keyword"}],staticClass:"form-control mr-sm-2",attrs:{type:"search",placeholder:"Select Feeder","aria-label":"Select Feeder"},domProps:{value:t.filter_report.search_feeder_keyword},on:{input:function(e){e.target.composing||t.$set(t.filter_report,"search_feeder_keyword",e.target.value)}}}):t._e()]),t._v(" "),t.filter_report.search_feeder_box_opened&&""==t.filter_report.feeder_id?r("div",{staticClass:"search-result-box"},[0==t.filter_report.search_feeder_result.length?r("div",{staticClass:"p-3 text-danger"},[t._v('\n                                            Search "'+t._s(t.filter_report.search_feeder_keyword)+'" not found\n                                        ')]):t._e(),t._v(" "),t.filter_report.search_feeder_result.length>0?r("div",[t._m(4),t._v(" "),r("div",{staticClass:"list-group"},[t._l(t.filter_report.search_feeder_result,function(e){return[r("div",{staticClass:"list-group-item list-group-item-action",on:{click:function(r){return r.preventDefault(),t.selectFeeder(e.id,e.fullname)}}},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-md-3 p-0"},[r("div",{staticClass:"center",staticStyle:{height:"80px",width:"80px"}},[r("img",{staticClass:"img-fluid rounded-circle",staticStyle:{height:"100%",width:"100%","object-fit":"cover"},attrs:{src:""!=e.photo_file?e.photo_file:"https://firebasestorage.googleapis.com/v0/b/pasarudang-6129d.appspot.com/o/_webs%2Fuser-img.png?alt=media&token=cb7062cb-1aab-428c-b5d2-8f84fee01cc3",alt:""}})])]),t._v(" "),r("div",{staticClass:"col-md-9"},[r("h5",{staticClass:"card-title"},[t._v("\n                                                                    "+t._s(e.fullname)+"\n                                                                ")]),t._v(" "),r("div",{staticClass:"row"},[r("div",{staticClass:"col-md-7 align-self-center"},[r("small",{staticClass:"text-orange mt-1"},[t._v("\n                                                                            "+t._s(e.vehicle_name)+", "+t._s(e.vehicle_police_number)+"\n                                                                        ")])])])])])])]})],2)]):t._e()]):t._e()]),t._v(" "),"by_year"==t.filter_report.method?r("div",{staticClass:"col-lg-2 col-md-2 col-sm-2"},[r("div",{staticClass:"form-group"},[t._m(5),t._v(" "),r("datepicker",{attrs:{minimumView:"year",maximumView:"year","input-class":"form-control",format:"yyyy"},model:{value:t.filter_report.selected_year,callback:function(e){t.$set(t.filter_report,"selected_year",e)},expression:"filter_report.selected_year"}})],1)]):t._e(),t._v(" "),"month_range"==t.filter_report.method?[r("div",{staticClass:"col-lg-2 col-md-2 col-sm-2"},[r("div",{staticClass:"form-group"},[t._m(6),t._v(" "),r("datepicker",{attrs:{minimumView:"month",maximumView:"year","input-class":"form-control",format:"yyyy/MM"},model:{value:t.filter_report.from_month,callback:function(e){t.$set(t.filter_report,"from_month",e)},expression:"filter_report.from_month"}})],1)]),t._v(" "),r("div",{staticClass:"col-lg-2 col-md-2 col-sm-2"},[r("div",{staticClass:"form-group"},[t._m(7),t._v(" "),r("datepicker",{attrs:{minimumView:"month",maximumView:"year","input-class":"form-control",format:"yyyy/MM"},model:{value:t.filter_report.to_month,callback:function(e){t.$set(t.filter_report,"to_month",e)},expression:"filter_report.to_month"}})],1)])]:t._e(),t._v(" "),"date_range"==t.filter_report.method?[r("div",{staticClass:"col-lg-2 col-md-2 col-sm-2"},[r("div",{staticClass:"form-group"},[t._m(8),t._v(" "),r("datepicker",{attrs:{minimumView:"date",maximumView:"year","input-class":"form-control",format:"yyyy/MM/dd"},model:{value:t.filter_report.from_date,callback:function(e){t.$set(t.filter_report,"from_date",e)},expression:"filter_report.from_date"}})],1)]),t._v(" "),r("div",{staticClass:"col-lg-2 col-md-2 col-sm-2"},[r("div",{staticClass:"form-group"},[t._m(9),t._v(" "),r("datepicker",{attrs:{minimumView:"date",maximumView:"year","input-class":"form-control",format:"yyyy/MM/dd"},model:{value:t.filter_report.to_date,callback:function(e){t.$set(t.filter_report,"to_date",e)},expression:"filter_report.to_date"}})],1)])]:t._e()],2),t._v(" "),r("div",{staticClass:"row"},[r("div",{staticClass:"col-md-12"},[r("button",{staticClass:"btn btn-primary btn-sm",attrs:{disabled:""==t.filter_report.feeder_id},on:{click:function(e){return e.preventDefault(),t.generateReport()}}},[t._v("Generate")])])])])])])])]),t._v(" "),r("div",{staticClass:"row"},[r("div",{staticClass:"col-md-12"},[r("div",{staticClass:"widget has-shadow"},[t._m(10),t._v(" "),r("div",{staticClass:"widget-body"},[r("button",{staticClass:"btn btn-info btn-sm",on:{click:function(e){return e.preventDefault(),t.printElem("reportResult")}}},[r("i",{staticClass:"ion-printer"}),t._v(" Print")]),t._v(" "),r("div",{staticClass:"bg-grey p-3 mt-4",staticStyle:{height:"700px","overflow-y":"scroll"},attrs:{id:"reportResult"}},[r("h3",[t._v("Feeder Distance Report")]),t._v(" "),r("small",[t._v("Feeder: "+t._s(t.filter_report.feeder_name))]),t._v(" "),r("br"),t._v(" "),r("small",[t._v("Status: "+t._s(t.filter_report.status_name))]),t._v(" "),r("br"),t._v(" "),r("small",[t._v("Filter By: "+t._s(t.filter_report.method))]),t._v(" "),r("br"),t._v(" "),"current_year"==t.filter_report.method||"by_year"==t.filter_report.method?r("small",[t._v("Year: "+t._s(t.filter_report._selected_year_formatted))]):t._e(),t._v(" "),"month_range"==t.filter_report.method?r("small",[t._v("From "+t._s(t.filter_report._from_month_format)+" "),r("small",[t._v("to")]),t._v(" "+t._s(t.filter_report._to_month_format))]):t._e(),t._v(" "),"date_range"==t.filter_report.method?r("small",[t._v("From "+t._s(t.filter_report._from_date_format)+" "),r("small",[t._v("to")]),t._v(" "+t._s(t.filter_report._to_date_format))]):t._e(),t._v(" "),r("div",{staticClass:"margin-top-10"},[r("table",{staticClass:"table table-report table-bordered",staticStyle:{width:"100%"}},[t._m(11),t._v(" "),r("tbody",[t._l(t.result.data,function(e){return r("tr",[r("td",[t._v(t._s(e.create_date))]),t._v(" "),r("td",[1==e.task_status?r("span",{staticClass:"badge badge-success"},[t._v("Completed")]):t._e(),t._v(" "),0==e.task_status?r("span",{staticClass:"badge badge-primary"},[t._v("Progress")]):t._e()]),t._v(" "),r("td",[e.type&&0==e.type?r("span",[t._v("Pickup")]):t._e(),t._v(" "),e.type&&1==e.type?r("span",[t._v("Delivery")]):t._e()]),t._v(" "),r("td",[r("small",[t._v("\n                                                Code: "+t._s(e.booking_code)+"\n                                            ")]),t._v(" "),r("br"),t._v(" "),r("small",[r("strong",[t._v("\n                                                    "+t._s(e.type&&0==e.type?"Pickup Address":"Destination Address")+"\n                                                ")])]),t._v(" "),r("br"),t._v(" "),r("span",[t._v("\n                                                "+t._s(e.type&&0==e.type?e.pickup_address:e.destination_address)+"\n                                            ")])]),t._v(" "),r("td",[t._v(t._s(t.$parent.formatMoney(e.distance,2))+" Km")])])}),t._v(" "),0==t.result.data.length?r("tr",[r("td",{staticClass:"bg-warning",attrs:{colspan:"5"}},[t._v("\n                                            Data Empty\n                                        ")])]):t._e()],2),t._v(" "),r("tr",[r("th",{staticClass:"text-right",attrs:{colspan:"4"}},[t._v("\n                                            Total Distance\n                                        ")]),t._v(" "),r("th",[t._v("\n                                           "+t._s(t.result.total_distance)+" Km\n                                        ")])])])])])])])])])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"row"},[e("div",{staticClass:"page-header"},[e("div",{staticClass:"d-flex align-items-center"},[e("h2",{staticClass:"page-header-title"},[this._v("\n                        Feeder Distance Report\n                    ")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"widget-header bordered no-actions"},[e("h4",[this._v("Filter")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("small",[e("label",{attrs:{for:""}},[e("strong",[this._v("Filter Method")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("small",[e("label",{attrs:{for:""}},[e("strong",[this._v("Feeder")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"p-3 text-grey-dark"},[e("small",[this._v("\n                                                    Feeder\n                                                ")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("small",[e("label",{attrs:{for:""}},[this._v("Tahun")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("small",[e("label",{attrs:{for:""}},[this._v("Start Month")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("small",[e("label",{attrs:{for:""}},[this._v("End Month")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("small",[e("label",{attrs:{for:""}},[this._v("Start Date")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("small",[e("label",{attrs:{for:""}},[this._v("End Date")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"widget-header bordered no-actions"},[e("h4",{staticClass:"float-left"},[this._v("Result")]),this._v(" "),e("div",{staticClass:"clearfix"})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("thead",[r("tr",[r("th",{attrs:{width:"10%"}},[t._v("Date")]),t._v(" "),r("th",{attrs:{width:"8%"}},[t._v("Status")]),t._v(" "),r("th",{attrs:{width:"11%"}},[t._v("Task")]),t._v(" "),r("th",{attrs:{width:"15%"}},[t._v("Booking")]),t._v(" "),r("th",{attrs:{width:"10%"}},[t._v("Distance")])])])}],!1,null,null,null);e.default=d.exports}}]);